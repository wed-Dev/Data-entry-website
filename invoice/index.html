<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Car Removal Invoice Generator - Dubai 24/7 Car Recovery & Towing Service">
    <meta name="theme-color" content="#1e3a8a">
    <title>Hamid Mukhtar Heavy & Light Trucks Transport - Invoice (Farhan)</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Invoice">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 0;
            overflow-x: hidden;
        }

        .invoice-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border: 3px solid #000;
            padding: 0;
        }

        /* Header Section */
        .invoice-header {
            text-align: center;
            padding: 20px;
            border-bottom: 2px solid #000;
        }

        .company-name-arabic {
            font-family: 'Cairo', Arial, sans-serif;
            font-size: 24px;
            font-weight: bold;
            color: #1e3a8a;
            margin-bottom: 5px;
        }

        .company-name-english {
            font-size: 26px;
            font-weight: bold;
            color: #1e3a8a;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .company-tagline {
            font-size: 22px;
            color: #1e3a8a;
            margin-bottom: 15px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 15px;
        }

        .header-left {
            text-align: left;
            flex: 1;
        }

        .service-badge {
            background: #1e3a8a;
            color: white;
            padding: 10px 20px;
            display: inline-block;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .invoice-number-section {
            text-align: left;
            font-size: 24px;
            font-weight: bold;
            color: #1e3a8a;
        }

        .header-center {
            text-align: center;
            flex: 1;
        }

        .invoice-type-box {
            border: 2px solid #000;
            padding: 8px 15px;
            display: inline-block;
            margin-top: 10px;
        }

        .invoice-type-arabic {
            font-family: 'Cairo', Arial, sans-serif;
            font-size: 14px;
        }

        .invoice-type-english {
            font-size: 12px;
            font-weight: bold;
        }

        .header-right {
            text-align: right;
            flex: 1;
        }

        .contact-info {
            font-size: 13px;
            line-height: 1.8;
        }

        .contact-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .phone-number {
            font-size: 18px;
            font-weight: bold;
            color: #000;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 5px;
        }

        .date-section {
            text-align: right;
            margin-top: 10px;
            font-size: 14px;
        }

        .date-label-arabic {
            font-family: 'Cairo', Arial, sans-serif;
        }

        /* Customer Info Section */
        .customer-info {
            padding: 15px 20px;
            border-bottom: 2px solid #000;
        }

        .info-row {
            display: flex;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .info-row.two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .info-group {
            display: flex;
            align-items: center;
        }

        .info-label {
            font-weight: bold;
            width: 150px;
            white-space: nowrap;
        }

        .info-value {
            flex: 1;
            border-bottom: 1px dotted #999;
        }

        .info-value input {
            width: 100%;
            border: none;
            background: transparent;
            font-size: 14px;
            outline: none;
            font-family: Arial, sans-serif;
        }

        /* Table Section */
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
        }

        .invoice-table th,
        .invoice-table td {
            border: 1px solid #1e3a8a;
            padding: 8px;
            text-align: center;
            font-size: 13px;
        }

        .invoice-table th {
            background: #fff;
            font-weight: bold;
            color: #1e3a8a;
        }

        .table-header-row {
            background: #fff;
        }

        .sr-no-col {
            width: 60px;
        }

        .description-col {
            width: 300px;
        }

        .qty-col {
            width: 80px;
        }

        .rate-col {
            width: 120px;
        }

        .amount-col {
            width: 140px;
        }

        .arabic-text {
            font-family: 'Cairo', Arial, sans-serif;
            font-size: 14px;
            display: block;
        }

        .english-text {
            font-size: 13px;
            font-weight: bold;
        }

        .sub-label {
            font-size: 11px;
            color: #666;
        }

        .invoice-table tbody tr {
            height: 35px;
        }

        .total-row {
            background: #fff;
            font-weight: bold;
        }

        .total-row td {
            border-top: 2px solid #1e3a8a;
        }

        .total-label {
            text-align: right !important;
            padding-right: 20px;
        }

        /* Footer Section */
        .invoice-footer {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            border-top: 2px solid #000;
        }

        .signature-section {
            text-align: center;
            font-size: 14px;
        }

        .signature-label-arabic {
            font-family: 'Cairo', Arial, sans-serif;
            font-style: italic;
        }

        .signature-label-english {
            font-style: italic;
        }

        .signature-line {
            display: inline-block;
            width: 150px;
            border-bottom: 1px dotted #000;
            margin: 0 5px;
        }

        .editable-input {
            border: none;
            background: transparent;
            text-align: center;
            outline: none;
            font-family: Arial, sans-serif;
            width: 100%;
            height: 100%;
            padding: 4px;
        }

        .editable-input:focus {
            background: #f0f9ff;
        }

        .invoice-number-input {
            border: none;
            background: transparent;
            font-size: 24px;
            font-weight: bold;
            color: #1e3a8a;
            width: 150px;
            outline: none;
        }

        .invoice-number-input:focus {
            background: #f0f9ff;
        }

        .date-input {
            border: none;
            background: transparent;
            font-size: 14px;
            width: 150px;
            outline: none;
        }

        .date-input:focus {
            background: #f0f9ff;
        }

        .action-buttons {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 1000;
            justify-content: center;
            max-width: 100%;
            flex-wrap: nowrap;
        }

        .action-btn {
            background: #1e3a8a;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            min-width: 140px;
            justify-content: center;
        }

        .action-btn:hover {
            background: #1e40af;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.3);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        .save-btn {
            background: #059669;
        }

        .save-btn:hover {
            background: #047857;
        }

        .share-btn {
            background: #dc2626;
        }

        .share-btn:hover {
            background: #b91c1c;
        }

        @media print {
            .action-buttons {
                display: none !important;
            }
            
            body {
                padding-bottom: 0 !important;
            }
        }

        /* Mobile Responsive Design */
        
        /* Tablets (max-width: 768px) */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                background: #fff;
            }
            
            .action-buttons {
                position: fixed;
                top: 10px;
                left: 10px;
                right: 10px;
                transform: none;
                gap: 8px;
                padding: 10px;
                background: rgba(255, 255, 255, 0.98);
                border-radius: 8px;
                box-shadow: 0 2px 12px rgba(0,0,0,0.15);
                flex-wrap: wrap;
            }
            
            .action-btn {
                padding: 10px 14px;
                font-size: 13px;
                min-width: 105px;
                flex: 1 1 30%;
            }
            
            .signature-dialog {
                width: 95vw;
                max-height: 85vh;
            }
            
            #signatureCanvas {
                height: 200px;
            }
            
            .signature-toolbar {
                flex-direction: column;
                gap: 8px;
                align-items: stretch;
            }
            
            .signature-toolbar .left,
            .signature-toolbar .right {
                width: 100%;
                display: flex;
                justify-content: center;
            }
            
            .signature-btn {
                flex: 1;
                min-width: 120px;
            }
            
            .invoice-container {
                border-width: 2px;
                margin-top: 70px;
            }
            
            .invoice-header {
                padding: 15px;
            }
            
            .company-name-arabic {
                font-size: 18px;
            }
            
            .company-name-english {
                font-size: 20px;
            }
            
            .company-tagline {
                font-size: 16px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .header-left,
            .header-center,
            .header-right {
                text-align: center;
                width: 100%;
            }
            
            .service-badge {
                display: inline-block;
                margin: 0 auto 10px;
            }
            
            .invoice-number-section {
                text-align: center;
                font-size: 20px;
            }
            
            .invoice-number-input {
                text-align: center;
                width: 130px;
            }
            
            .invoice-type-box {
                margin: 10px auto;
            }
            
            .contact-info {
                text-align: center;
            }
            
            .phone-number {
                justify-content: center;
                font-size: 16px;
            }
            
            .date-section {
                text-align: center;
            }
            
            .date-input {
                text-align: center;
                width: 130px;
            }
            
            .customer-info {
                padding: 12px 15px;
            }
            
            .info-row {
                margin-bottom: 12px;
            }
            
            .info-row.two-columns {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .info-group {
                flex-direction: column;
                align-items: flex-start;
                width: 100%;
            }
            
            .info-label {
                width: 100%;
                margin-bottom: 5px;
                font-size: 13px;
            }
            
            .info-value {
                width: 100%;
                border-bottom: 1px dotted #999;
            }
            
            .info-value input {
                font-size: 13px;
                width: 100%;
                padding: 6px 4px;
            }
            
            .invoice-table {
                font-size: 11px;
            }
            
            .invoice-table th,
            .invoice-table td {
                padding: 6px 4px;
                font-size: 11px;
            }
            
            .arabic-text {
                font-size: 11px;
            }
            
            .english-text {
                font-size: 10px;
            }
            
            .sub-label {
                font-size: 9px;
            }
            
            .sr-no-col {
                width: 35px;
            }
            
            .qty-col {
                width: 50px;
            }
            
            .rate-col {
                width: 85px;
            }
            
            .amount-col {
                width: 85px;
            }
        }

        /* Mobile devices (max-width: 576px) */
        @media (max-width: 576px) {
            body {
                padding: 5px;
            }
            
            .action-buttons {
                top: 5px;
                left: 5px;
                right: 5px;
                padding: 8px;
                gap: 6px;
                flex-wrap: wrap;
            }
            
            .action-btn {
                padding: 9px 10px;
                font-size: 12px;
                min-width: 95px;
                gap: 4px;
                flex: 1 1 30%;
            }
            
            .signature-modal {
                padding: 8px;
            }
            
            .signature-dialog {
                width: 98vw;
                max-height: 88vh;
            }
            
            .signature-header {
                padding: 10px 12px;
                font-size: 14px;
            }
            
            .signature-body {
                padding: 6px 12px;
            }
            
            #signatureCanvas {
                height: 180px;
            }
            
            .signature-toolbar {
                padding: 8px 12px;
                flex-direction: column;
                gap: 8px;
            }
            
            .signature-toolbar .left {
                flex-direction: column;
                gap: 6px;
            }
            
            .signature-btn {
                padding: 9px 14px;
                font-size: 13px;
                width: 100%;
            }
            
            #signatureFile {
                font-size: 12px;
                padding: 6px;
            }
            
            .invoice-container {
                margin-top: 65px;
                border-width: 2px;
            }
            
            .invoice-header {
                padding: 12px;
            }
            
            .company-name-arabic {
                font-size: 16px;
                line-height: 1.3;
            }
            
            .company-name-english {
                font-size: 17px;
                line-height: 1.3;
                letter-spacing: 0.5px;
            }
            
            .company-tagline {
                font-size: 14px;
            }
            
            .header-content {
                gap: 12px;
            }
            
            .service-badge {
                padding: 8px 15px;
                font-size: 12px;
            }
            
            .invoice-number-section {
                font-size: 18px;
            }
            
            .invoice-number-input {
                font-size: 18px;
                width: 110px;
            }
            
            .invoice-type-box {
                padding: 6px 12px;
            }
            
            .invoice-type-arabic {
                font-size: 12px;
            }
            
            .invoice-type-english {
                font-size: 11px;
            }
            
            .contact-info {
                font-size: 12px;
                line-height: 1.6;
            }
            
            .phone-number {
                font-size: 15px;
            }
            
            .date-section {
                font-size: 12px;
            }
            
            .date-input {
                font-size: 12px;
                width: 110px;
            }
            
            .customer-info {
                padding: 10px 12px;
            }
            
            .info-row {
                margin-bottom: 10px;
                display: flex;
                flex-direction: column;
                width: 100%;
            }
            
            .info-row.two-columns {
                grid-template-columns: 1fr;
                gap: 10px;
                display: grid;
            }
            
            .info-group {
                display: flex;
                flex-direction: column;
                width: 100%;
            }
            
            .info-label {
                font-size: 12px;
                width: 100%;
                margin-bottom: 5px;
            }
            
            .info-value {
                width: 100%;
                border-bottom: 1px dotted #999;
            }
            
            .info-value input {
                font-size: 12px;
                padding: 5px 2px;
                width: 100%;
                display: block;
            }
            
            .invoice-table th,
            .invoice-table td {
                padding: 5px 3px;
                font-size: 10px;
            }
            
            .arabic-text {
                font-size: 10px;
            }
            
            .english-text {
                font-size: 9px;
            }
            
            .sub-label {
                font-size: 8px;
            }
            
            .sr-no-col {
                width: 30px;
            }
            
            .description-col {
                width: auto;
                min-width: 120px;
            }
            
            .qty-col {
                width: 40px;
            }
            
            .rate-col {
                width: 70px;
            }
            
            .amount-col {
                width: 70px;
            }
            
            .invoice-table tbody tr {
                height: 32px;
            }
            
            .total-row td {
                padding: 8px 6px !important;
                font-size: 10px !important;
            }
            
            .total-row img {
                max-width: 70px !important;
                height: 24px !important;
            }
            
            .total-row > td:first-child > div {
                font-size: 10px !important;
            }
            
            .total-row > td:last-child > span {
                font-size: 11px !important;
            }
            
            .total-row > td:last-child > div {
                font-size: 13px !important;
                margin-top: 5px !important;
            }
        }

        /* Small mobile devices (max-width: 400px) */
        @media (max-width: 400px) {
            body {
                padding: 3px;
            }
            
            .action-buttons {
                top: 3px;
                left: 3px;
                right: 3px;
                padding: 6px;
                gap: 5px;
                flex-wrap: wrap;
                justify-content: space-between;
            }
            
            .action-btn {
                padding: 8px 8px;
                font-size: 11px;
                min-width: 85px;
                flex: 1 1 30%;
                gap: 3px;
            }
            
            .signature-modal {
                padding: 5px;
            }
            
            .signature-dialog {
                width: 99vw;
                max-height: 90vh;
                border-radius: 6px;
            }
            
            .signature-header {
                padding: 8px 10px;
                font-size: 13px;
            }
            
            .signature-body {
                padding: 5px 10px;
            }
            
            #signatureCanvas {
                height: 150px;
            }
            
            .signature-toolbar {
                padding: 6px 10px;
            }
            
            .signature-btn {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            #signatureFile {
                font-size: 11px;
                padding: 5px;
            }
            
            .invoice-container {
                margin-top: 80px;
                border-width: 1px;
            }
            
            .invoice-header {
                padding: 10px;
            }
            
            .company-name-arabic {
                font-size: 14px;
            }
            
            .company-name-english {
                font-size: 15px;
            }
            
            .company-tagline {
                font-size: 12px;
            }
            
            .header-content {
                gap: 10px;
            }
            
            .service-badge {
                padding: 6px 12px;
                font-size: 11px;
            }
            
            .invoice-number-section {
                font-size: 16px;
            }
            
            .invoice-number-input {
                font-size: 16px;
                width: 100px;
            }
            
            .invoice-type-box {
                padding: 5px 10px;
            }
            
            .invoice-type-arabic {
                font-size: 11px;
            }
            
            .invoice-type-english {
                font-size: 10px;
            }
            
            .contact-info {
                font-size: 11px;
            }
            
            .phone-number {
                font-size: 14px;
            }
            
            .date-section {
                font-size: 11px;
            }
            
            .date-input {
                font-size: 11px;
                width: 100px;
            }
            
            .customer-info {
                padding: 8px 10px;
            }
            
            .info-row {
                margin-bottom: 8px;
                display: flex;
                flex-direction: column;
                width: 100%;
            }
            
            .info-row.two-columns {
                grid-template-columns: 1fr;
                gap: 8px;
                display: grid;
            }
            
            .info-group {
                display: flex;
                flex-direction: column;
                width: 100%;
            }
            
            .info-label {
                font-size: 11px;
                margin-bottom: 4px;
                width: 100%;
            }
            
            .info-value {
                width: 100%;
                border-bottom: 1px dotted #999;
            }
            
            .info-value input {
                font-size: 11px;
                padding: 4px 2px;
                width: 100%;
                display: block;
            }
            
            .invoice-table th,
            .invoice-table td {
                padding: 4px 2px;
                font-size: 9px;
            }
            
            .arabic-text {
                font-size: 9px;
            }
            
            .english-text {
                font-size: 8px;
            }
            
            .sub-label {
                font-size: 7px;
            }
            
            .sr-no-col {
                width: 25px;
            }
            
            .description-col {
                min-width: 100px;
            }
            
            .qty-col {
                width: 35px;
            }
            
            .rate-col {
                width: 60px;
            }
            
            .amount-col {
                width: 60px;
            }
            
            .invoice-table tbody tr {
                height: 28px;
            }
            
            .total-row td {
                padding: 6px 4px !important;
                font-size: 9px !important;
            }
            
            .total-row img {
                max-width: 60px !important;
                height: 20px !important;
            }
            
            .total-row > td:first-child > div {
                font-size: 9px !important;
            }
            
            .total-row > td:last-child > span {
                font-size: 10px !important;
            }
            
            .total-row > td:last-child > div {
                font-size: 12px !important;
                margin-top: 4px !important;
            }
        }

        /* Extra small mobile devices (max-width: 320px) */
        @media (max-width: 320px) {
            body {
                padding: 2px;
            }
            
            .action-buttons {
                top: 2px;
                left: 2px;
                right: 2px;
                padding: 5px;
                gap: 4px;
                flex-wrap: wrap;
            }
            
            .action-btn {
                padding: 7px 6px;
                font-size: 10px;
                min-width: 75px;
                flex: 1 1 48%;
                gap: 2px;
            }
            
            .signature-modal {
                padding: 3px;
            }
            
            .signature-dialog {
                width: 100vw;
                max-height: 92vh;
                border-radius: 4px;
            }
            
            .signature-header {
                padding: 6px 8px;
                font-size: 12px;
            }
            
            .signature-header button {
                padding: 4px 8px;
                font-size: 11px;
            }
            
            .signature-body {
                padding: 4px 8px;
            }
            
            #signatureCanvas {
                height: 130px;
            }
            
            .signature-toolbar {
                padding: 5px 8px;
                gap: 6px;
            }
            
            .signature-btn {
                padding: 7px 10px;
                font-size: 11px;
            }
            
            #signatureFile {
                font-size: 10px;
                padding: 4px;
            }
            
            .invoice-container {
                margin-top: 75px;
            }
            
            .invoice-header {
                padding: 8px;
            }
            
            .company-name-arabic {
                font-size: 13px;
            }
            
            .company-name-english {
                font-size: 14px;
            }
            
            .company-tagline {
                font-size: 11px;
            }
            
            .service-badge {
                padding: 5px 10px;
                font-size: 10px;
            }
            
            .invoice-number-section {
                font-size: 15px;
            }
            
            .invoice-number-input {
                font-size: 15px;
                width: 90px;
            }
            
            .invoice-type-box {
                padding: 4px 8px;
            }
            
            .invoice-type-arabic {
                font-size: 10px;
            }
            
            .invoice-type-english {
                font-size: 9px;
            }
            
            .contact-info {
                font-size: 10px;
            }
            
            .phone-number {
                font-size: 13px;
            }
            
            .date-section {
                font-size: 10px;
            }
            
            .date-input {
                font-size: 10px;
                width: 90px;
            }
            
            .customer-info {
                padding: 6px 8px;
            }
            
            .info-row {
                margin-bottom: 7px;
                display: flex;
                flex-direction: column;
                width: 100%;
            }
            
            .info-row.two-columns {
                grid-template-columns: 1fr;
                gap: 6px;
                display: grid;
            }
            
            .info-group {
                display: flex;
                flex-direction: column;
                width: 100%;
            }
            
            .info-label {
                font-size: 10px;
                margin-bottom: 3px;
                width: 100%;
            }
            
            .info-value {
                width: 100%;
                border-bottom: 1px dotted #999;
            }
            
            .info-value input {
                font-size: 10px;
                padding: 3px 1px;
                width: 100%;
                display: block;
            }
            
            .invoice-table th,
            .invoice-table td {
                padding: 3px 1px;
                font-size: 8px;
            }
            
            .arabic-text {
                font-size: 8px;
            }
            
            .english-text {
                font-size: 7px;
            }
            
            .sub-label {
                font-size: 6px;
            }
            
            .sr-no-col {
                width: 22px;
            }
            
            .description-col {
                min-width: 80px;
            }
            
            .qty-col {
                width: 30px;
            }
            
            .rate-col {
                width: 50px;
            }
            
            .amount-col {
                width: 50px;
            }
            
            .invoice-table tbody tr {
                height: 26px;
            }
            
            .total-row td {
                padding: 5px 3px !important;
                font-size: 8px !important;
            }
            
            .total-row img {
                max-width: 50px !important;
                height: 18px !important;
            }
            
            .total-row > td:first-child > div {
                font-size: 8px !important;
            }
            
            .total-row > td:last-child > span {
                font-size: 9px !important;
            }
            
            .total-row > td:last-child > div {
                font-size: 11px !important;
                margin-top: 3px !important;
                min-height: 20px !important;
            }
        }

        /* Landscape orientation for mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            .invoice-container {
                margin-top: 65px;
            }
            
            .action-buttons {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .action-btn {
                flex: 0 1 auto;
                min-width: 110px;
            }
            
            .signature-dialog {
                max-height: 95vh;
            }
            
            #signatureCanvas {
                height: 160px;
            }
            
            .signature-toolbar {
                flex-direction: row;
            }
            
            .signature-toolbar .left {
                flex-direction: row;
            }
            
            .header-content {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .header-left,
            .header-center,
            .header-right {
                flex: 1 1 30%;
                min-width: 150px;
            }
            
            .header-left {
                text-align: left;
                align-items: flex-start;
            }
            
            .header-center {
                text-align: center;
                align-items: center;
            }
            
            .header-right {
                text-align: right;
                align-items: flex-end;
            }
            
            .service-badge {
                margin: 0 0 8px 0;
            }
            
            .invoice-number-section {
                text-align: left;
            }
            
            .invoice-number-input {
                text-align: left;
            }
            
            .date-section {
                text-align: right;
            }
            
            .date-input {
                text-align: right;
            }
            
            .phone-number {
                justify-content: flex-end;
            }
            
            .info-row.two-columns {
                grid-template-columns: 1fr 1fr;
            }
        }
        /* Signature Modal */
        .signature-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 16px; }
        .signature-modal.open { display: flex; }
        .signature-dialog { background: #fff; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); width: min(900px,95vw); max-height: 90vh; display: flex; flex-direction: column; overflow: hidden; }
        .signature-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid #e5e7eb; font-weight: bold; }
        .signature-body { padding: 8px 16px; background: #fafafa; }
        #signatureCanvas { width: 100%; height: 220px; border: 1px dashed #94a3b8; background: #fff; touch-action: none; border-radius: 6px; }
        .signature-toolbar { display: flex; gap: 10px; justify-content: space-between; align-items: center; padding: 10px 16px; border-top: 1px solid #e5e7eb; background: #fff; }
        .signature-toolbar .left { display: flex; gap: 8px; align-items: center; }
        .signature-btn { background: #1e3a8a; color: #fff; border: none; border-radius: 6px; padding: 10px 16px; font-weight: bold; cursor: pointer; }
        .signature-btn.secondary { background: #6b7280; }
        .signature-btn.destructive { background: #dc2626; }
        @media (max-width: 576px) { #signatureCanvas { height: 180px; } }
        @media (max-width: 400px) { #signatureCanvas { height: 150px; } }
    </style>
</head>
<body>
    <div class="action-buttons">
        <button class="action-btn" onclick="openSignatureModal()">âœï¸ Sign</button>
        <button class="action-btn save-btn" onclick="saveInvoiceAsImage()">ğŸ’¾ Save to Gallery</button>
        <button class="action-btn share-btn" onclick="shareInvoice()">ğŸ“¤ Share</button>
    </div>

    <!-- Signature Modal -->
    <div id="signatureModal" class="signature-modal" aria-hidden="true" role="dialog" aria-labelledby="signatureTitle">
        <div class="signature-dialog">
            <div class="signature-header">
                <div id="signatureTitle">Draw or Upload Signature</div>
                <button class="signature-btn destructive" onclick="closeSignatureModal()" aria-label="Close">âœ–</button>
            </div>
            <div class="signature-body">
                <canvas id="signatureCanvas"></canvas>
            </div>
            <div class="signature-toolbar">
                <div class="left">
                    <input type="file" id="signatureFile" accept="image/*">
                    <button class="signature-btn secondary" onclick="clearSignature()">Clear</button>
                </div>
                <div class="right">
                    <button class="signature-btn" onclick="applySignature()">Use Signature</button>
                </div>
            </div>
        </div>
    </div>
    <div class="invoice-container">
        <!-- Header -->
        <div class="invoice-header">
            <div class="company-name-arabic">Ø­Ø§Ù…Ø¯ Ù…Ø®ØªØ§Ø± Ù„Ù„Ù†Ù‚Ù„ Ø¨Ø§Ù„Ø´Ø§Ø­Ù†Ø§Øª Ø§Ù„Ø«Ù‚ÙŠÙ„Ø© ÙˆØ§Ù„Ø®ÙÙŠÙØ© (Ø´.Ø°.Ù….Ù…)</div>
            <div class="company-name-english">HAMID MUKHTAR HEAVY & LIGHT TRUCKS TRANSPORT (L.L.C)</div>
            <div class="company-tagline">Dubai 24/7 Car Recovery & Towing Service</div>
            
            <div class="header-content">
                <div class="header-left">
                    <div class="service-badge">Car Removal<br>Service</div>
                    <div class="invoice-number-section">No.: <input type="text" class="invoice-number-input" placeholder="Enter No."></div>
                </div>
                
                <div class="header-center">
                    <div class="invoice-type-box">
                        <div class="invoice-type-arabic">ÙØ§ØªÙˆØ±Ø© Ù†Ù‚Ø¯Ø§ / Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨</div>
                        <div class="invoice-type-english">CASH / DEBIT INVOICE</div>
                    </div>
                </div>
                
                <div class="header-right">
                    <div class="contact-info">
                        Email: Ahmadfarhan32304gmail.com
                        <div class="contact-name">Ahmad Farhan</div>
                        <div class="phone-number">
                            <span>ğŸ“</span> +971 543881803
                        </div>
                    </div>
                    <div class="date-section">
                        <span class="date-label-arabic">Ø§Ù„ØªØ§Ø±ÙŠØ®</span> Date.: <input type="date" class="date-input" id="invoiceDate">
                    </div>
                </div>
            </div>
        </div>

        <!-- Customer Info -->
        <div class="customer-info">
            <div class="info-row two-columns">
                <div class="info-group">
                    <div class="info-label">Company Name:</div>
                    <div class="info-value"><input type="text" placeholder="Enter company name"></div>
                </div>
                <div class="info-group">
                    <div class="info-label">Vehicle Number:</div>
                    <div class="info-value"><input type="text" placeholder="Enter vehicle number"></div>
                </div>
            </div>
            <div class="info-row two-columns">
                <div class="info-group">
                    <div class="info-label">Current Location:</div>
                    <div class="info-value"><input type="text" placeholder="Enter current location"></div>
                </div>
                <div class="info-group">
                    <div class="info-label">Destination Location:</div>
                    <div class="info-value"><input type="text" placeholder="Enter destination location"></div>
                </div>
            </div>
            <div class="info-row">
                <div class="info-label">Distance (KM):</div>
                <div class="info-value"><input type="text" placeholder="Enter distance in kilometers"></div>
            </div>
        </div>

        <!-- Invoice Table -->
        <table class="invoice-table">
            <thead>
                <tr class="table-header-row">
                    <th class="sr-no-col">
                        <span class="arabic-text">Ø§Ù„Ø±Ù‚Ù…</span>
                        <span class="english-text">Sr.<br>No.</span>
                    </th>
                    <th class="description-col">
                        <span class="arabic-text">Ø§Ù„ØªÙÙ€Ù€Ù€Ø§ØµÙ€Ù€ÙŠÙ€Ù€Ù€Ù€Ù€Ù€Ù„</span>
                        <span class="english-text">Description</span>
                    </th>
                    <th class="qty-col">
                        <span class="arabic-text">Ø§Ù„Ø¹Ø¯Ø¯</span>
                        <span class="english-text">Qty.</span>
                    </th>
                    <th class="rate-col">
                        <span class="arabic-text">Ø§Ù„Ø³Ø¹Ø±</span>
                        <span class="english-text">Rate</span>
                        <div>
                            <span class="sub-label">Ø¯Ø±Ù‡Ù…<br>Dhs.</span>
                            <span class="sub-label">ÙÙ„Ø³<br>Fills.</span>
                        </div>
                    </th>
                    <th class="amount-col">
                        <span class="arabic-text">Ø§Ù„Ù…Ø¨Ù„Øº</span>
                        <span class="english-text">Amount</span>
                        <div>
                            <span class="sub-label">Ø¯Ø±Ù‡Ù…<br>Dhs.</span>
                            <span class="sub-label">ÙÙ„Ø³<br>Fills.</span>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody id="invoiceTableBody">
                <!-- Editable rows for data entry -->
                <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                <tr><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td><td contenteditable="true"></td></tr>
                
                <!-- Total Row -->
                <tr class="total-row">
                    <td style="border-top: 2px solid #1e3a8a; border-right: 1px solid #1e3a8a; padding: 6px 4px; vertical-align: bottom; min-width: 120px;">
                        <div style="font-size: 12px; font-weight: bold;">Signature:</div>
                        <img id="signatureImage" src="data:image/jpeg;base64,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" alt="Signature" style="max-width: 100px; height: 32px; display: block; margin-top: 2px;">
                    </td>
                    <td colspan="4" style="border-top: 2px solid #1e3a8a; padding: 6px 12px; vertical-align: bottom; text-align: right;">
                        <span style="font-size: 13px; font-weight: bold;">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø¯Ø±Ù‡Ù…&nbsp;&nbsp;Total Dirhams</span>
                        <div contenteditable="true" style="margin-top: 8px; min-width: 120px; min-height: 24px; border-bottom: 1px dotted #999; text-align: right; font-size: 15px; font-weight: bold;"></div>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>

    <!-- html2canvas and jsPDF libraries for converting HTML to PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }

        document.getElementById('invoiceDate').valueAsDate = new Date();
        const randomInvoiceNumber = Math.floor(100000 + Math.random() * 900000);
        document.querySelector('.invoice-number-input').value = randomInvoiceNumber;
        const rows = document.querySelectorAll('#invoiceTableBody tr:not(.total-row)');
        rows.forEach((row, index) => {
            if (index < 5) {
                const firstCell = row.querySelector('td:first-child');
                if (firstCell) {
                    firstCell.textContent = index + 1;
                }
            } else {
                const firstCell = row.querySelector('td:first-child');
                if (firstCell) {
                    firstCell.textContent = '';
                }
            }
        });

        async function saveInvoiceAsImage() {
            const invoiceContainer = document.querySelector('.invoice-container');
            const actionButtons = document.querySelector('.action-buttons');
            const body = document.body;
            
            // Store original styles
            const originalContainerStyle = invoiceContainer.style.cssText;
            const originalBodyStyle = body.style.cssText;
            const originalMarginTop = invoiceContainer.style.marginTop;
            
            // Hide buttons and force desktop layout
            actionButtons.style.display = 'none';
            body.style.padding = '0';
            body.style.margin = '0';
            body.style.background = '#ffffff';
            invoiceContainer.style.marginTop = '0';
            invoiceContainer.style.maxWidth = '800px';
            invoiceContainer.style.margin = '0 auto';
            invoiceContainer.style.transform = 'none';
            
            await new Promise(resolve => setTimeout(resolve, 400));
            
            try {
                const canvas = await html2canvas(invoiceContainer, {
                    scale: 3,
                    backgroundColor: '#ffffff',
                    logging: false,
                    useCORS: true,
                    allowTaint: true,
                    width: 800,
                    height: invoiceContainer.scrollHeight,
                    windowWidth: 800,
                    windowHeight: invoiceContainer.scrollHeight,
                    x: 0,
                    y: 0,
                    scrollX: 0,
                    scrollY: 0,
                    ignoreElements: (element) => {
                        return element.classList.contains('action-buttons') || 
                               element.classList.contains('action-btn') ||
                               (element.closest && element.closest('.signature-modal'));
                    }
                });
                
                const { jsPDF } = window.jspdf;
                const pageWidth = 210;
                const pageHeight = 297;
                const imgWidth = pageWidth;
                const imgHeight = (canvas.height * pageWidth) / canvas.width;
                const pdf = new jsPDF('p', 'mm', 'a4', true);
                const imgData = canvas.toDataURL('image/png', 1.0);
                
                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight, undefined, 'FAST');
                const invoiceNumber = document.querySelector('.invoice-number-input').value || 'invoice';
                const date = new Date().toISOString().split('T')[0];
                const fileName = `Invoice_${invoiceNumber}_${date}.pdf`;
                pdf.save(fileName);
                
                // Restore original styles
                invoiceContainer.style.cssText = originalContainerStyle;
                body.style.cssText = originalBodyStyle;
                actionButtons.style.display = 'flex';
                
                alert('âœ… Invoice PDF saved perfectly! Check your Downloads folder.');
            } catch (error) {
                console.error('Error saving invoice:', error);
                
                // Restore original styles on error too
                invoiceContainer.style.cssText = originalContainerStyle;
                body.style.cssText = originalBodyStyle;
                actionButtons.style.display = 'flex';
                
                alert('âŒ Error saving invoice. Please try again.');
            }
        }

        async function shareInvoice() {
            const invoiceContainer = document.querySelector('.invoice-container');
            const actionButtons = document.querySelector('.action-buttons');
            const body = document.body;
            
            // Store original styles
            const originalContainerStyle = invoiceContainer.style.cssText;
            const originalBodyStyle = body.style.cssText;
            const originalMarginTop = invoiceContainer.style.marginTop;
            
            // Hide buttons and force desktop layout
            actionButtons.style.display = 'none';
            body.style.padding = '0';
            body.style.margin = '0';
            body.style.background = '#ffffff';
            invoiceContainer.style.marginTop = '0';
            invoiceContainer.style.maxWidth = '800px';
            invoiceContainer.style.margin = '0 auto';
            invoiceContainer.style.transform = 'none';
            
            await new Promise(resolve => setTimeout(resolve, 400));
            
            try {
                const canvas = await html2canvas(invoiceContainer, {
                    scale: 3,
                    backgroundColor: '#ffffff',
                    logging: false,
                    useCORS: true,
                    allowTaint: true,
                    width: 800,
                    height: invoiceContainer.scrollHeight,
                    windowWidth: 800,
                    windowHeight: invoiceContainer.scrollHeight,
                    x: 0,
                    y: 0,
                    scrollX: 0,
                    scrollY: 0,
                    ignoreElements: (element) => {
                        return element.classList.contains('action-buttons') || 
                               element.classList.contains('action-btn') ||
                               (element.closest && element.closest('.signature-modal'));
                    }
                });
                
                const { jsPDF } = window.jspdf;
                const pageWidth = 210;
                const pageHeight = 297;
                const imgWidth = pageWidth;
                const imgHeight = (canvas.height * pageWidth) / canvas.width;
                const pdf = new jsPDF('p', 'mm', 'a4', true);
                const imgData = canvas.toDataURL('image/png', 1.0);
                
                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight, undefined, 'FAST');
                const invoiceNumber = document.querySelector('.invoice-number-input').value || 'invoice';
                const date = new Date().toISOString().split('T')[0];
                const fileName = `Invoice_${invoiceNumber}_${date}.pdf`;
                const pdfBlob = pdf.output('blob');
                
                // Restore original styles before sharing
                invoiceContainer.style.cssText = originalContainerStyle;
                body.style.cssText = originalBodyStyle;
                actionButtons.style.display = 'flex';
                
                const url = URL.createObjectURL(pdfBlob);
                const link = document.createElement('a');
                link.download = fileName;
                link.href = url;
                link.click();
                URL.revokeObjectURL(url);
                
                if (navigator.share && navigator.canShare) {
                    const file = new File([pdfBlob], fileName, { type: 'application/pdf' });
                    if (navigator.canShare({ files: [file] })) {
                        try {
                            await navigator.share({
                                files: [file],
                                title: 'Invoice',
                                text: `Invoice #${invoiceNumber}`
                            });
                            console.log('Invoice shared successfully');
                        } catch (err) {
                            if (err.name !== 'AbortError') {
                                console.error('Share failed:', err);
                            }
                        }
                    } else {
                        alert('âœ… Invoice saved perfectly to Downloads!');
                    }
                } else {
                    alert('âœ… Invoice saved perfectly to Downloads!');
                }
            } catch (error) {
                console.error('Error sharing invoice:', error);
                
                // Restore original styles on error
                invoiceContainer.style.cssText = originalContainerStyle;
                body.style.cssText = originalBodyStyle;
                actionButtons.style.display = 'flex';
                
                alert('âŒ Error sharing invoice. Please try again.');
            }
        }

        function fallbackShare(blob, fileName) {
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.download = fileName;
            link.href = url;
            link.click();
            URL.revokeObjectURL(url);
            alert('ğŸ“± Sharing is not supported on this device. Invoice PDF downloaded instead!');
        }
        
        // Signature Pad Logic
        let sigCanvas, sigCtx, sigDrawing = false, sigHasDrawn = false, sigRect, sigRatio = 1;
        function resizeSignatureCanvas() {
            if (!sigCanvas) return;
            const dpr = window.devicePixelRatio || 1;
            sigRect = sigCanvas.getBoundingClientRect();
            sigCanvas.width = Math.floor(sigRect.width * dpr);
            sigCanvas.height = Math.floor(sigRect.height * dpr);
            sigRatio = dpr;
            sigCtx = sigCanvas.getContext('2d');
            sigCtx.scale(dpr, dpr);
            sigCtx.lineWidth = 2;
            sigCtx.lineJoin = 'round';
            sigCtx.lineCap = 'round';
            sigCtx.strokeStyle = '#111827';
            // Keep background white for clean PNG
            sigCtx.fillStyle = '#ffffff';
            sigCtx.fillRect(0, 0, sigCanvas.width, sigCanvas.height);
            sigHasDrawn = false;
        }
        function getSigPos(e) {
            const rect = sigCanvas.getBoundingClientRect();
            const clientX = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const clientY = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            return { x: clientX, y: clientY };
        }
        function startSig(e) {
            e.preventDefault();
            sigDrawing = true;
            sigHasDrawn = true;
            const p = getSigPos(e);
            sigCtx.beginPath();
            sigCtx.moveTo(p.x, p.y);
        }
        function moveSig(e) {
            if (!sigDrawing) return;
            e.preventDefault();
            const p = getSigPos(e);
            sigCtx.lineTo(p.x, p.y);
            sigCtx.stroke();
        }
        function endSig(e) {
            if (!sigDrawing) return;
            e.preventDefault();
            sigDrawing = false;
        }
        function clearSignature() {
            if (!sigCanvas) return;
            sigCtx.fillStyle = '#ffffff';
            sigCtx.fillRect(0, 0, sigCanvas.width, sigCanvas.height);
            sigHasDrawn = false;
            const file = document.getElementById('signatureFile');
            if (file) file.value = '';
        }
        function openSignatureModal() {
            const modal = document.getElementById('signatureModal');
            modal.classList.add('open');
            sigCanvas = document.getElementById('signatureCanvas');
            // Initialize and bind
            resizeSignatureCanvas();
            window.addEventListener('resize', resizeSignatureCanvas);
            sigCanvas.addEventListener('pointerdown', startSig);
            sigCanvas.addEventListener('pointermove', moveSig);
            sigCanvas.addEventListener('pointerup', endSig);
            sigCanvas.addEventListener('pointerleave', endSig);
            sigCanvas.addEventListener('touchstart', startSig, { passive: false });
            sigCanvas.addEventListener('touchmove', moveSig, { passive: false });
            sigCanvas.addEventListener('touchend', endSig, { passive: false });
        }
        function closeSignatureModal() {
            const modal = document.getElementById('signatureModal');
            modal.classList.remove('open');
            window.removeEventListener('resize', resizeSignatureCanvas);
        }
        function applySignature() {
            const img = document.getElementById('signatureImage');
            const fileInput = document.getElementById('signatureFile');
            const useCanvas = !fileInput.files || fileInput.files.length === 0;
            if (useCanvas) {
                if (!sigHasDrawn) {
                    // Nothing drawn; keep existing image
                    closeSignatureModal();
                    return;
                }
                const data = sigCanvas.toDataURL('image/png');
                img.src = data;
                closeSignatureModal();
            } else {
                const file = fileInput.files[0];
                const reader = new FileReader();
                reader.onload = () => {
                    img.src = reader.result;
                    closeSignatureModal();
                };
                reader.readAsDataURL(file);
            }
        }
    </script>
</body>
</html>
